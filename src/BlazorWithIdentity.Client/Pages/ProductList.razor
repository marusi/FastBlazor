@using BlazorWithIdentity.Shared.DTO.Category
@using BlazorWithIdentity.Shared.DTO.ProductSku

<div class="row row-sm">
  <div class="col-md-12">
  @*Pagination*@
  </div>
  <div class="col-md-12">
    <div class="putbox-content">
      <div class="content-title">u</div>

      <div class="combobox">

          @if (categories== null)
{
    <p><em>Loading...</em></p>
}
else
{
         
         <select  class="form-control"    @bind="query.CategoryId">
                                                  
                                                    @foreach (var item in categories)
                                                    {
                                                        <option value="@item.Id">@item.Name</option>
                                                    }
                                                </select>
                                                 }

      
      </div>


    </div>
  </div>

</div>
  







<ol class="list-items">
  <li class="list-items-row">
     <p>@query.CategoryId</p> 

  </li>



  @if (productSkus == null)
{
   <li class="list-items-row">
       <div class="entity-list ">
        <div class="entity-list-item "  >
          <div class="item-icon">
            <span class="glyph glyph-warning"></span>
          </div>
           <div class="item-content-secondary">
              <div class="content-text-tertiary "> <span class="label label-danger">Nothing here</span>  </div>
          </div>
          </div>
          </div>
  </li>
} else
{
    @foreach (var item in productSkus.Items)
    {
       <li class="list-items-row" >
    <div class="row">
      <div class="entity-list ">
        <div class="entity-list-item "  >
          <div class="item-icon">
            <span class="glyph glyph-chevron-right"></span>
          </div>
          <div class="item-content-secondary">
               @item.SkuValue.SkuValueName
              <div class="content-text-tertiary "> <span class="label label-warning">@item.SkuValue.OptionValue.Option.Product.ProductCategory.Name</span>  </div>
          </div>

          <div class="item-content-primary">

            <div class="content-text-primary ">@item.SkuValue.OptionValue.Option.Product.ProductName </div>
            <div class="content-text-secondary">@item.SkuValue.OptionValue.OptionValueName - KES @item.Price </div>


          </div>


        </div>
      </div>

    </div>
  </li>
    }
}

 
</ol>














@code {

    ProductSkuDTO productSkuValueDTO { get; set; } = new ProductSkuDTO();
   ProductSkuQueryDTO query { get; set; } = new ProductSkuQueryDTO();
     
   
    string error { get; set; }
     [Inject]
    public IProductSkuDataService ProductSkuDataService { get; set; }

      [Inject]
    public ICategoryDataService CategoryDataService { get; set; }

   

  




    @functions {


        // private ProductSkuDTO[] productSkus { get; set; }
        private QueryResultDTO<ProductSkuDTO> productSkus { get; set; }
         private ProductCategoryDTO[] categories { get; set; }
        protected override async Task OnInitializedAsync()
        {
          

             categories = await CategoryDataService.GetCategories();
             OnFilterProducts();
           
          
            StateHasChanged();
        
        }        private  async Task OnFilterProducts()
        {              var props = GetProperties(query);
            foreach (var prop in props)
		{
                if (prop.Key != "CategoryId")
                {
                 // productSkus = await ProductSkuDataService.GetProductSkus("");  
                } else if (prop.Key == "CategoryId") {

                    var combined = $"{prop.Key}={prop.Value}";
                    productSkus = await ProductSkuDataService.GetProductSkus(combined);
                      await OnInitializedAsync();
                 } else if (prop.Key == "OptionValueId") {

                    var combined = $"{prop.Key}=";
                    productSkus = await ProductSkuDataService.GetProductSkus(combined);
                }
		}
        }        private static Dictionary<string, string> GetProperties(object obj)
	{
		var props = new Dictionary<string, string>();
		if (obj == null)
			return props;

		var type = obj.GetType();
		foreach (var prop in type.GetProperties())
		{
			var val = prop.GetValue(obj, new object[] { });
			var valStr = val == null ? "" : val.ToString();
			props.Add(prop.Name, valStr);
		}

		return props;
	}            

        }
}
