@page "/productdata/{Id:int}"
@attribute [Authorize]
@using BlazorWithIdentity.Shared
@inject HttpClient Http
@using BlazorWithIdentity.Shared.DTO.Category
@using BlazorWithIdentity.Shared.DTO.Product


<div class="row row-sm">
<div class="container">
    <FluentCard style="height:25%">
  
 <EditForm class="form-category" OnValidSubmit="OnSubmitProduct" Model="productItem">
         
      <div class="col-md-8">
         
        

                </div>
                <div class="col-md-8">

                    <FluentTextField id="inputCategory"  @bind-Value="productItem.ProductName"  placeholder="@productItem.ProductName"  ></FluentTextField>
                    <ValidationMessage class="text-danger" For="@(() => productItem.ProductName)" />


                </div>

                <div class="col-md-8">
                    <FluentButton type="submit" Appearance="Appearance.Accent">Submit</FluentButton>
                    <label class="text-danger">@error</label> 

                </div>



            </EditForm>
        </FluentCard>
    </div>

</div>






@code { [Parameter]
    public int Id { get; set; }
    string error { get; set; }


    ProductDTO productItem { get; set; } = new ProductDTO();
    SaveProductDTO saveProductDTO { get; set; } = new SaveProductDTO();





    [Inject]
    public ICategoryDataService CategoryDataService { get; set; }
    [Inject]
    public IProductDataService ProductDataService { get; set; }

    async Task OnSubmitProduct()
    {
        error = null;
        try
        {
            await ProductDataService.UpdateProduct(Id, productItem);
            toastService.ShowToast($"{productItem.ProductName} added Succesfuly", ToastLevel.Success);
            //  StateHasChanged();
            //    await OnInitializedAsync();
            navigationManager.NavigateTo("/category");



        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
    @functions {


       
       
      
      protected override async Task OnInitializedAsync()
    {
          
            productItem = await ProductDataService.GetProductById(Id);
            
          // dataList = await CategoryDataService.GetCategories();
            // toastService.ShowToast($"Items loaded succesfuly", ToastLevel.Info);
    }

      
    }
}
